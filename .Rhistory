test_2 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod5,color=mod5)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_3 <- ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=daily,color=daily)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Actual Daily") +
scale_color_viridis("Actual Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~
t2(n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_2 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod5,color=mod5)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_3 <- ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=daily,color=daily)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Actual Daily") +
scale_color_viridis("Actual Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~
te(n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
rmse(model_4_predicted,text_test$daily)
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_2 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod5,color=mod5)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~ participant_id +
te(n,daily_sentiment, by=participant_id, k=10, bs=c("tp")),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4 <- gam(daily ~ participant_id +
te(n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_2 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod5,color=mod5)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4 <- gam(daily ~
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
model_4 <- gam(daily ~ day_of_week
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
model_4 <- gam(daily ~ day_of_week +
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
weekdays1 <- c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday')
gam_data_sentiment$day_of_week <- c('weekend', 'weekday')[gam_data_sentiment$day_of_week %in% weekdays1)+1L]
gam_data_sentiment$day_of_week <- c('weekend', 'weekday')[gam_data_sentiment$day_of_week %in% weekdays1+1L]
gam_data_sentiment$weekend <- as.factor(gam_data_sentiment$weekend)
model_4 <- gam(daily ~ day_of_week +
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4 <- gam(daily ~ weekend +
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
model_4 <- gam(daily ~
t2(log_n,daily_sentiment,by = weekend k=10, bs=c("tp"))+
model_4 <- gam(daily ~
t2(log_n,daily_sentiment,by = weekend, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
text_train <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(if (n() >= 15) row_number() < (n()-3) else row_number() <= (n()-0))
text_test <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(n() >= 15)
text_test <- text_test %>%
group_by(participant_id) %>%
filter(row_number() >= (n()-3))
model_4 <- gam(daily ~
t2(log_n,daily_sentiment,by = weekend, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_5_predicted <- predict(model_5,text_test,type="response")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_2 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod5,color=mod5)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~ weekend +
t2(log_n,daily_sentiment, k=10, bs=c("tp"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
rmse(model_4_predicted,text_test$daily)
model_4 <- gam(daily ~ weekend +
t2(log_n,daily_sentiment, k=10, bs=c("sos"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4 <- gam(daily ~ weekend +
t2(log_n,daily_sentiment, k=10, bs=c("ts"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_3 <- ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=daily,color=daily)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Actual Daily") +
scale_color_viridis("Actual Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
model_4 <- gam(daily ~ weekend +
te(log_n,daily_sentiment, k=10, bs=c("ts"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
plot(model_4)
model_4 <- gam(daily ~ weekend +
s(log_n,daily_sentiment, by=participant_id, k=10, bs=c("sos"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
plot(model_4)
model_4 <- gam(daily ~ weekend +
s(log_n,daily_sentiment, by=participant_id, k=10, bs=c("ts"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
plot(model_4)
model_4 <- gam(daily ~ weekend +
s(log_n,daily_sentiment, k=10, bs=c("sos"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_3 <- ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=daily,color=daily)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Actual Daily") +
scale_color_viridis("Actual Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
gam_data_sentiment <- gam_data_sentiment %>%
filter(participant_id 1= 1006)
gam_data_sentiment <- gam_data_sentiment %>%
filter(participant_id != 1006)
daily_text_sentiment <- text_tidy_data_filtered %>%
group_by(participant_id,date) %>%
count(daily_sentiment=mean(sentiment))
gam_data_sentiment <- merge(daily_text_sentiment, daily_ema_data, by=c("participant_id","date")) %>%
select(participant_id,date,daily_sentiment,n,site,daily,day_of_week,weekend)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(n()>=5)
gam_data_sentiment <- gam_data_sentiment[order(gam_data_sentiment$participant_id, gam_data_sentiment$date), ]
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(diff_days = 1:n())
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(lag_days = difftime(date, lag(date),units="days"))
gam_data_sentiment$lag_days <- as.numeric(gam_data_sentiment$lag_days)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(is.na(lead(lag_days)) | !lead(lag_days)==0)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(lag_days = difftime(date, lag(date),units="days"))
gam_data_sentiment <- gam_data_sentiment %>%
filter(participant_id != 1006)
daily_text_sentiment <- text_tidy_data_filtered %>%
group_by(participant_id,date) %>%
count(daily_sentiment=mean(sentiment))
daily_text_sentiment <- text_tidy_data_filtered %>%
group_by(participant_id,date) %>%
count(daily_sentiment=mean(sentiment))
gam_data_sentiment <- merge(daily_text_sentiment, daily_ema_data, by=c("participant_id","date")) %>%
select(participant_id,date,daily_sentiment,n,site,daily,day_of_week,weekend)
gam_data_sentiment <- merge(daily_text_sentiment, daily_ema_data, by=c("participant_id","date")) %>%
select(participant_id,date,daily_sentiment,n,site,daily,day_of_week,weekend)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(n()>=5)
gam_data_sentiment <- gam_data_sentiment[order(gam_data_sentiment$participant_id, gam_data_sentiment$date), ]
gam_data_sentiment <- merge(daily_text_sentiment, daily_ema_data, by=c("participant_id","date")) %>%
select(participant_id,date,daily_sentiment,n,site,daily,day_of_week,weekend)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(n()>=5)
gam_data_sentiment <- gam_data_sentiment[order(gam_data_sentiment$participant_id, gam_data_sentiment$date), ]
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(diff_days = 1:n())
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(diff_days = 1:n())
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(lag_days = difftime(date, lag(date),units="days"))
gam_data_sentiment$lag_days <- as.numeric(gam_data_sentiment$lag_days)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(is.na(lead(lag_days)) | !lead(lag_days)==0)
gam_data_sentiment <- gam_data_sentiment %>%
group_by(participant_id) %>%
mutate(lag_days = difftime(date, lag(date),units="days"))
gam_data_sentiment <- gam_data_sentiment %>%
filter(participant_id != 1006)
gam_data_sentiment$participant_id <- as.factor(gam_data_sentiment$participant_id)
gam_data_sentiment$diff_days <- as.numeric(gam_data_sentiment$diff_days)
gam_data_sentiment$log_n <- log(gam_data_sentiment$n)
func <- function(xx)
{
return(data.frame(COR = cor(xx$daily_sentiment, xx$daily), LENG =length(xx$log_n)))
}
library(plyr)
library(apaTables)
cor(gam_data_sentiment$daily_sentiment,gam_data_sentiment$daily)
model_3 <- gam(daily ~
s(log_n,daily_sentiment,by=participant_id, k=10, bs=c("tp"),m=2)+
s(participant_id, bs="re"),
data=gam_data_sentiment,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
stuff <- transform(gam_data_sentiment, modG = predict(model_3, type="response"))
library(viridis)
test_1 <-ggplot(data=stuff, aes(x=log_n, y=daily_sentiment, fill=modG,color=modG)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
stuff <- transform(gam_data_sentiment, modG = predict(model_3, type="response"))
gam_data_sentiment$weekend <- as.factor(gam_data_sentiment$weekend)
text_train <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(if (n() >= 15) row_number() < (n()-3) else row_number() <= (n()-0))
text_test <- gam_data_sentiment %>%
group_by(participant_id) %>%
filter(n() >= 15)
text_test <- text_test %>%
group_by(participant_id) %>%
filter(row_number() >= (n()-3))
model_4 <- gam(daily ~ weekend +
s(log_n,daily_sentiment, k=10, bs=c("sos"))+
s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_4_predicted <- predict(model_4,text_test,type="response")
library(Metrics)
rmse(model_4_predicted,text_test$daily)
text_test$predicted <- model_4_predicted
model_5 <- gam(daily ~
1 + s(participant_id, bs="re"),
data=text_train,
correlation = corARMA(form = ~ diff_days|participant_id),
method="REML")
model_5_predicted <- predict(model_5,text_test,type="response")
rmse(model_5_predicted,text_test$daily)
model_5_predicted <- predict(model_5,text_test,type="response")
text_test <- transform(text_test, mod4 = predict(model_4,text_test,type="response"))
library(viridis)
text_test <- transform(text_test, mod5 = predict(model_5,text_test,type="response"))
test_1 <-ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=mod4,color=mod4)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Predicted Daily") +
scale_color_viridis("Predicted Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
test_3 <- ggplot(data=text_test, aes(x=log_n, y=daily_sentiment, fill=daily,color=daily)) +
geom_tile(size=5) +
facet_wrap(~ participant_id) +
scale_fill_viridis("Actual Daily") +
scale_color_viridis("Actual Daily") +
labs(x = "Number of Texts", y = "Sentiment") +
theme(legend.position="right")
plot_grid(test_1, test_3,
ncol=1,
align="vh",
axis = "lrtb",
labels=c("A","B"),
rel_heights= c(1,1))
